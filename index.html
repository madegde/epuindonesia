<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPU Indonesia - Economic Policy Uncertainty Index</title>
    <meta name="description" content="Economic Policy Uncertainty Index for Indonesia (1994-2024)">
    
    <!-- Plotly.js from CDN -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background: #f8f9fa;
        }

        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 100px 20px;
            text-align: center;
        }

        .hero h1 {
            font-size: 3.5em;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .hero .subtitle {
            font-size: 1.3em;
            opacity: 0.95;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        .section {
            background: white;
            padding: 60px;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        h2 {
            font-size: 2.2em;
            margin-bottom: 30px;
            color: #2c3e50;
        }

        .chart-container {
            margin: 40px 0;
            height: 600px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.95;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .download-btn {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            margin: 10px 5px;
            transition: transform 0.3s;
        }

        .download-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="hero">
        <h1>EPU Indonesia</h1>
        <p class="subtitle">Economic Policy Uncertainty Index for Indonesia (1994-2024)</p>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Overview Section -->
        <section class="section">
            <h2>Research Overview</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">30</div>
                    <div class="stat-label">Years Analyzed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">6,340</div>
                    <div class="stat-label">Articles Processed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">362</div>
                    <div class="stat-label">Monthly EPU Values</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">5</div>
                    <div class="stat-label">News Sources</div>
                </div>
            </div>

            <p style="font-size: 1.1em; line-height: 1.8; margin-top: 30px;">
                This study constructs the first comprehensive news-based Economic Policy Uncertainty (EPU) index for Indonesia, covering October 1994 to December 2024. Using the Baker, Bloom, and Davis (2016) methodology, we analyze 6,340 articles from five leading Indonesian newspapers to track policy uncertainty over three decades.
            </p>
        </section>

        <!-- Article Coverage Chart -->
        <section class="section">
            <h2>Figure 1: Article Coverage per Publisher</h2>
            <div class="chart-container">
                <div class="loader" id="loader1"></div>
                <div id="article-coverage-chart" style="width:100%;height:100%;"></div>
            </div>
            
            <div style="margin-top: 20px;">
                <a href="#" class="download-btn" onclick="downloadData('article-coverage')">Download Article Coverage Data</a>
            </div>
        </section>

        <!-- EPU Index Chart -->
        <section class="section">
            <h2>Figure 2: Economic Policy Uncertainty Index</h2>
            <div class="chart-container">
                <div class="loader" id="loader2"></div>
                <div id="epu-index-chart" style="width:100%;height:100%;"></div>
            </div>
            
            <div style="margin-top: 20px;">
                <a href="#" class="download-btn" onclick="downloadData('epu-index')">Download EPU Index Data</a>
                <a href="#" class="download-btn" onclick="downloadData('full-dataset')">Download Full Dataset</a>
            </div>
        </section>

        <!-- Methodology -->
        <section class="section">
            <h2>Methodology</h2>
            <p><strong>Data Sources:</strong> Articles from The Jakarta Post, LKBN ANTARA, Bisnis Indonesia, Tempo, and The Jakarta Globe</p>
            <p><strong>Period:</strong> October 1994 - December 2024</p>
            <p><strong>Method:</strong> Baker, Bloom & Davis (2016) news-based EPU index construction</p>
            <p><strong>Keywords:</strong> Economic + Policy + Uncertainty terms (see paper for full list)</p>
        </section>
    </div>

<script>
        // Load your actual data
        let epuData = null;
        let articleData = null;
        let statsData = null;

        // Initialize the application
        async function initializeApp() {
            try {
                await loadRealData();
                createArticleChart();
                createEPUChart();
                updateStatistics();
            } catch (error) {
                console.error('Error loading data:', error);
                await loadFallbackData();
            }
        }

        // Load data from your exported JavaScript files
        async function loadRealData() {
            try {
                // Option 1: Load from separate JS files
                await loadScript('js/epu_data.js');
                await loadScript('js/article_data.js');
                await loadScript('js/stats_data.js');
                await loadScript('js/events_data.js');
                
            } catch (error) {
                // Option 2: Load from combined JSON file
                const response = await fetch('data/combined_data.json');
                const data = await response.json();
                
                window.epuData = data.epu_index;
                window.articleData = data.articles;
                window.statsData = data.stats;
                window.majorEvents = data.events;
            }
        }

        // Helper function to load JavaScript files
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // Create EPU Index Chart with your real data
        function createEPUChart() {
            document.getElementById('loading2').style.display = 'none';
            
            if (!window.epuData) {
                console.error('EPU data not loaded');
                return;
            }

            // Filter data based on date range
            const dateFilter = document.getElementById('date-filter').value;
            let filteredData = window.epuData;
            
            if (dateFilter !== 'all') {
                const ranges = {
                    '1990s': ['1990-01-01', '1999-12-31'],
                    '2000s': ['2000-01-01', '2009-12-31'],
                    '2010s': ['2010-01-01', '2019-12-31'],
                    '2020s': ['2020-01-01', '2029-12-31']
                };
                
                if (ranges[dateFilter]) {
                    filteredData = window.epuData.filter(d => {
                        const date = new Date(d.Month);
                        return date >= new Date(ranges[dateFilter][0]) && 
                               date <= new Date(ranges[dateFilter][1]);
                    });
                }
            }

            const trace = {
                x: filteredData.map(d => d.Month),
                y: filteredData.map(d => d.EPU_Index),
                type: 'scatter',
                mode: 'lines',
                name: 'EPU Index',
                line: {
                    color: '#667eea',
                    width: 3,
                    shape: 'spline'
                },
                fill: 'tonexty',
                fillcolor: 'rgba(102, 126, 234, 0.1)',
                hovertemplate: '<b>EPU Index</b><br>Date: %{x}<br>Value: %{y:.1f}<extra></extra>'
            };

            const layout = {
                title: {
                    text: 'Economic Policy Uncertainty Index for Indonesia',
                    font: {size: 20, family: 'Arial, sans-serif', color: '#2c3e50'}
                },
                xaxis: {
                    title: 'Date',
                    type: 'date',
                    showgrid: true,
                    gridcolor: '#E5E5E5',
                    tickformat: '%Y',
                    showline: true,
                    linecolor: '#E5E5E5'
                },
                yaxis: {
                    title: 'EPU Index',
                    showgrid: true,
                    gridcolor: '#E5E5E5',
                    showline: true,
                    linecolor: '#E5E5E5'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                height: 550,
                margin: {l: 80, r: 50, t: 100, b: 80},
                annotations: [],
                hovermode: 'x unified'
            };

            // Add event annotations if enabled
            if (document.getElementById('show-events').checked && window.majorEvents) {
                window.majorEvents.forEach(event => {
                    const eventDate = new Date(event.date);
                    const rangeStart = new Date(filteredData[0]?.Month);
                    const rangeEnd = new Date(filteredData[filteredData.length - 1]?.Month);
                    
                    if (eventDate >= rangeStart && eventDate <= rangeEnd) {
                        layout.annotations.push({
                            x: event.date,
                            y: event.value,
                            text: event.text,
                            showarrow: true,
                            arrowhead: 2,
                            arrowsize: 1.2,
                            arrowwidth: 2,
                            arrowcolor: '#e74c3c',
                            ax: 0,
                            ay: -50,
                            bgcolor: 'rgba(255,255,255,0.95)',
                            bordercolor: '#e74c3c',
                            borderwidth: 1.5,
                            font: {size: 11, color: '#333', family: 'Arial'},
                            captureevents: true
                        });
                    }
                });
            }

            const config = {
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d', 'autoScale2d'],
                displaylogo: false,
                toImageButtonOptions: {
                    format: 'png',
                    filename: 'epu_indonesia_index',
                    height: 600,
                    width: 1200,
                    scale: 2
                }
            };

            Plotly.newPlot('epu-chart', [trace], layout, config);
        }

        // Create Article Coverage Chart with your real data
        function createArticleChart() {
            document.getElementById('loading1').style.display = 'none';
            
            if (!window.articleData) {
                console.error('Article data not loaded');
                return;
            }

            // Filter data based on publisher selection
            const publisherFilter = document.getElementById('publisher-filter').value;
            let filteredData = window.articleData;
            
            if (publisherFilter !== 'all') {
                filteredData = window.articleData.filter(d => d.Publisher_Code === publisherFilter);
            }

            // Group data by publisher for separate traces
            const publisherGroups = {};
            filteredData.forEach(d => {
                if (!publisherGroups[d.Publisher_Code]) {
                    publisherGroups[d.Publisher_Code] = {
                        dates: [],
                        publishers: [],
                        names: [],
                        headlines: []
                    };
                }
                publisherGroups[d.Publisher_Code].dates.push(d.Date);
                publisherGroups[d.Publisher_Code].publishers.push(d.Publisher_Code);
                publisherGroups[d.Publisher_Code].names.push(d.Publisher);
                publisherGroups[d.Publisher_Code].headlines.push(d.Headline);
            });

            const traces = [];
            const colors = {
                'JKPOST': '#1f77b4',
                'ANTARA': '#ff7f0e', 
                'BISNIS': '#2ca02c',
                'TEMPOE': '#d62728',
                'TEMGEN': '#9467bd',
                'JGLOBE': '#8c564b'
            };

            Object.keys(publisherGroups).forEach(pubCode => {
                const group = publisherGroups[pubCode];
                traces.push({
                    x: group.dates,
                    y: group.publishers,
                    mode: 'markers',
                    type: 'scatter',
                    name: group.names[0], // Publisher full name
                    marker: {
                        color: colors[pubCode] || '#000000',
                        size: 8,
                        opacity: 0.7,
                        line: {
                            width: 1,
                            color: 'white'
                        }
                    },
                    text: group.headlines,
                    hovertemplate: '<b>%{fullData.name}</b><br>Date: %{x}<br>%{text}<extra></extra>'
                });
            });

            const layout = {
                title: {
                    text: 'Article Coverage per Publisher Over Time',
                    font: {size: 20, family: 'Arial, sans-serif', color: '#2c3e50'}
                },
                xaxis: {
                    title: 'Date',
                    type: 'date',
                    showgrid: true,
                    gridcolor: '#E5E5E5',
                    showline: true,
                    linecolor: '#E5E5E5'
                },
                yaxis: {
                    title: 'Publisher',
                    categoryorder: 'array',
                    categoryarray: ['JKPOST', 'ANTARA', 'BISNIS', 'TEMPOE', 'TEMGEN', 'JGLOBE'],
                    showgrid: true,
                    gridcolor: '#E5E5E5'
                },
                plot_bgcolor: 'white',
                paper_bgcolor: 'white',
                height: 550,
                margin: {l: 120, r: 50, t: 100, b: 80},
                legend: {
                    orientation: 'v',
                    x: 1.02,
                    y: 1,
                    bgcolor: 'rgba(255,255,255,0.9)',
                    bordercolor: '#E5E5E5',
                    borderwidth: 1
                },
                hovermode: 'closest'
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d', 'autoScale2d'],
                displaylogo: false,
                toImageButtonOptions: {
                    format: 'png',
                    filename: 'article_coverage_indonesia',
                    height: 600,
                    width: 1200,
                    scale: 2
                }
            };

            Plotly.newPlot('article-chart', traces, layout, config);
        }

        // Update functions
        function updateEPUChart() {
            createEPUChart();
        }

        function updateArticleChart() {
            createArticleChart();
        }

        // Update statistics display
        function updateStatistics() {
            if (window.statsData) {
                document.getElementById('epu-count').textContent = 
                    `${window.statsData.epu_articles} articles (${window.statsData.epu_percentage}%)`;
                
                // Update stat cards with real data
                const statCards = document.querySelectorAll('.stat-number');
                if (statCards.length >= 4) {
                    statCards[1].textContent = window.statsData.total_articles.toLocaleString();
                    statCards[2].textContent = window.statsData.months_covered;
                    statCards[3].textContent = window.statsData.epu_percentage + '%';
                }
            }
        }

        // Download functions
        function downloadCSV(type) {
            let csvContent = "data:text/csv;charset=utf-8,";
            let filename = "";
            
            if (type === 'epu' && window.epuData) {
                csvContent += "Date,EPU_Index\n";
                window.epuData.forEach(row => {
                    csvContent += `${row.Month},${row.EPU_Index}\n`;
                });
                filename = "epu_indonesia_index.csv";
                
            } else if (type === 'articles' && window.articleData) {
                csvContent += "Date,Publisher,Publisher_Code,Headline\n";
                window.articleData.slice(0, 100).forEach(row => { // Limit to first 100 for performance
                    csvContent += `${row.Date},"${row.Publisher}",${row.Publisher_Code},"${row.Headline}"\n`;
                });
                filename = "article_coverage_sample.csv";
                
            } else {
                alert('Data not available for download');
                return;
            }
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Fallback data if files can't be loaded
        async function loadFallbackData() {
            console.log('Loading fallback data...');
            
            // Use key data points from your research
            window.epuData = [
                {Month: '1994-10-01', EPU_Index: 42.23},
                {Month: '1998-06-01', EPU_Index: 319.96},
                {Month: '2001-05-01', EPU_Index: 254.69},
                {Month: '2002-08-01', EPU_Index: 247.48},
                {Month: '2008-05-01', EPU_Index: 128.56},
                {Month: '2020-09-01', EPU_Index: 227.74},
                {Month: '2022-08-01', EPU_Index: 220.29},
                {Month: '2024-11-01', EPU_Index: 186.57},
                {Month: '2024-12-01', EPU_Index: 167.47}
            ];

            window.majorEvents = [
                {date: '1998-06-01', text: 'Asian Financial Crisis', value: 319.96},
                {date: '2001-05-01', text: 'Wahid Scandal', value: 254.69},
                {date: '2020-09-01', text: 'COVID-19 Pandemic', value: 227.74},
                {date: '2022-08-01', text: 'Russia-Ukraine War', value: 220.29}
            ];

            window.articleData = [
                {Date: '1994-10-04', Publisher: 'The Jakarta Post', Publisher_Code: 'JKPOST', Headline: 'TRADE MINISTERS OF APEC TO DISCUSS NEW GATT HERE.'},
                {Date: '2000-01-31', Publisher: 'LKBN ANTARA', Publisher_Code: 'ANTARA', Headline: 'Economic policy uncertainty discussion'},
                {Date: '1997-09-27', Publisher: 'Bisnis Indonesia', Publisher_Code: 'BISNIS', Headline: 'Financial market uncertainty'}
            ];

            window.statsData = {
                total_articles: 6340,
                epu_articles: 6236,
                epu_percentage: 98.4,
                months_covered: 362
            };

            createArticleChart();
            createEPUChart();
            updateStatistics();
        }

        // Event listeners
        document.getElementById('show-events').addEventListener('change', updateEPUChart);
        document.getElementById('date-filter').addEventListener('change', updateEPUChart);
        document.getElementById('publisher-filter').addEventListener('change', updateArticleChart);

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);

        // Handle window resize for responsive charts
        window.addEventListener('resize', function() {
            if (document.getElementById('article-chart').children.length > 0) {
                Plotly.Plots.resize('article-chart');
            }
            if (document.getElementById('epu-chart').children.length > 0) {
                Plotly.Plots.resize('epu-chart');
            }
        });
    </script>
</body>
</html>
